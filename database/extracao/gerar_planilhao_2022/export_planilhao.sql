\COPY ( select cd_identificador_osc as cnpj, tx_razao_social_osc as razao_social, tx_nome_fantasia_osc as nome_fantasia, cd_natureza_juridica_osc as natureza_juridica, tx_nome_natureza_juridica as nat_jur_dessc, dt_fundacao_osc as data_inicio, extract(year from dt_fundacao_osc) as ano_inicio, div_cnae20_corrigido as cnae_divisao_corrigido, grp_cnae20_corrigido as cnae_grupo_corrigido, clas_cnae20_corrigido as cnae_classe_corrigido, tx_nome_classe_atividade_economica as classe_desc, sbcl_cnae_corrigido as cnae_subclase_corrigido, tx_nome_subclasse_atividade_economica as subclasse_desc, tx_endereco as endereco, tx_bairro as bairro, nr_cep as cep, codemun as codemun, edmu_nm_municipio as municipio, eduf_sg_uf as uf, LEFT(tx_telefone, 2) as ddd, substr(tx_telefone,3) as telefone, tx_email as email, macro_area_atuacao, micro_area_atuacao, qtd_vinc_ativos as n_vinc_ativos, qtd_portador_defic as n_vinc_defic from osc.tb_osc a join osc.tb_dados_gerais b ON a.id_osc = b.id_osc join syst.dc_natureza_juridica c ON b.cd_natureza_juridica_osc = c.cd_natureza_juridica left join graph.tb_rais d ON a.cd_identificador_osc = d.id_estab and d.ano_rais = 2015 left join syst.dc_classe_atividade_economica e ON d.clas_cnae20_corrigido = e.cd_classe_atividade_economica left join syst.dc_subclasse_atividade_economica f ON d.sbcl_cnae_corrigido = cast(f.cd_subclasse_atividade_economica as text) join osc.tb_localizacao g on a.id_osc = g.id_osc join spat.ed_municipio h on g.cd_municipio = h.edmu_cd_municipio join spat.ed_uf i on h.eduf_cd_uf = i.eduf_cd_uf join osc.tb_contato j on a.id_osc = j.id_osc where and a.id_osc not in (789809)) TO 'planilhao_2022.csv' WITH (FORMAT CSV, HEADER, DELIMITER ';', FORCE_QUOTE *);